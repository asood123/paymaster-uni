// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "../src/contracts/PaymasterUniGovernance.sol";

contract PaymasterUniGovernanceTest is Test {
    PaymasterUniGovernance public paymaster;

    function setUp() public {
        IEntryPoint entryPoint = IEntryPoint(address(0x0));
        address owner = vm.envAddress("PUBLIC_KEY");
        vm.prank(owner);
        paymaster = new PaymasterUniGovernance(entryPoint);
        vm.prank(owner);
        vm.roll(30000);
        paymaster.addOrModifyProposal(52, block.timestamp - 15, block.timestamp + 15, block.number - 1, block.number + 1 );
    }

    function test_PassingProposalIdExists() public {
        ProposalWindow memory pd = paymaster.getProposalId(52);
        assertEq(pd.startBlock == block.number - 1, true);
        assertEq(pd.endBlock == block.number + 1, true);
    }

    // TODO: update tests as _verifyCallData is now internal
    /* 
    function testFail_NoCallData() public {
        bytes memory testCallData = hex"";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_CallDataLessThan452() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignatureOnly() public {
        bytes memory testCallData = hex"b61d27f6";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignature_AddressOnly() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignature_Address_ValueOnly() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c30000000000000000000000000000000000000000000000000000000000000000";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignature_Address_Value_Data1Only() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignature_Address_Value_Data1_Data2Only() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ExecuteSignature_Address_Value_Data1_Data2_castVote_Only() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000445678138800000000000000000000000000000000000000000000000000000000";
        paymaster._verifyCallData(testCallData);
    }

    function testFail_ProposalID_Fifty_one() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044567813880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000320000000100000000000000000000000000000000000000000000000000000000";
        paymaster._verifyCallData(testCallData);
    }

    function test_PassingCallDataYesVote() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044567813880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000001";
       paymaster._verifyCallData(testCallData);
    }

    function test_PassingCallDataNoVote() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044567813880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000000";
        paymaster._verifyCallData(testCallData);
    }

    function test_PassingCallDataAbstainVote() public {
        bytes memory testCallData = hex"b61d27f6000000000000000000000000408ed6354d4973f66138c91495f2f2fcbd8724c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044567813880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000002";
        paymaster._verifyCallData(testCallData);
    }
    */
}
